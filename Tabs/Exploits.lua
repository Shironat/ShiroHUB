local S = require(script.Parent.Parent.UnrecTables.Services)
local Players = S.Players
local RunService = S.RunService

local K = require(script.Parent.Parent.UnrecTables.States)
local --wait

local Mexploits = {}

function Mexploits.Init(Window, Tab)

-- Reset
Exploits:CreateButton({
    Name = "Reset",
    Callback = function()
        forceReset()
    end
})

-- Rejoin
Exploits:CreateButton({
    Name = "Relogar",
    Callback = function()
        rejoin()
    end
})

-- WalkSpeed
Exploits:CreateToggle({
    Name = "WalkSpeed",
    Callback = function(Value)
        speedEnabled = Value
        local hum = getHumanoid()

        if speedEnabled then
            originalSpeed = originalSpeed or hum.WalkSpeed
            hum.WalkSpeed = originalSpeed * 1.5
        else
            if originalSpeed then
                hum.WalkSpeed = originalSpeed
                originalSpeed = nil
            end
        end
    end
})

-- Jump
Exploits:CreateToggle({
    Name = "JumpForce",
    Callback = function(Value)
        jumpEnabled = Value
        local hum = getHumanoid()

        if jumpEnabled then
            originalJump = originalJump or getJumpValue(hum)
            setJumpValue(hum, originalJump * 2)
        else
            if originalJump then
                setJumpValue(hum, originalJump)
                originalJump = nil
            end
        end
    end
})

-- Fly
Exploits:CreateToggle({
    Name = "Self Freeze",
    Callback = function(Value)
        flyEnabled = Value
        if flyEnabled then
            startFly()
        else
            stopFly()
        end
    end
})

-- Noclip
Exploits:CreateToggle({
    Name = "Noclip",
    Callback = function(Value)
        noclipEnabled = Value
        if noclipEnabled then
            noclipConn = RunService.Stepped:Connect(function()
                setNoclip(true)
            end)
        else
            if noclipConn then noclipConn:Disconnect() end
            setNoclip(false)
        end
    end
})

-- ESP
Exploits:CreateToggle({
    Name = "ESP",
    Callback = function(Value)
        ESP_ENABLED = Value
        if not Value then
            for char in pairs(espCache) do
                removeESP(char)
            end
        end
    end
})

-- Touch Fling
Exploits:CreateToggle({
   Name = "TouchFling - Obsoleto",
   Callback = function(Value)
      flingEnabled = Value
      if flingEnabled then
         startFling()
      else
         stopFling()
      end
   end
})

-- Bring
local BringDropdown = Exploits:CreateDropdown({
    Name = "Bring",
    Options = getPlayerList(),
    CurrentOption = {"All"},
    MultipleOptions = false,
    Callback = function(Option)
        local selected = Option[1]

        if selected == "All" then
            for _, plr in ipairs(Players:GetPlayers()) do
                bringPlayer(plr)
            end
        else
            local target = Players:FindFirstChild(selected)
            if target then
                bringPlayer(target)
            end
        end
    end
})

Players.PlayerAdded:Connect(function()
    BringDropdown:Refresh(getPlayerList())
end)
Players.PlayerRemoving:Connect(function()
    BringDropdown:Refresh(getPlayerList())
end)

-- Anti Afk
Exploits:CreateButton({
    Name = "Anti AFK",
    Callback = function()
        if antiIdleActive then return end
        antiIdleActive = true

        idleConnection = player.Idled:Connect(function()
            VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            task.wait(1)
            VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        end)
    end
})

-- Plataforma AFK
Exploits:CreateButton({
    Name = "Plataforma AFK",
    Callback = function()
        local hrp = getHRP()

        if workspace:FindFirstChild("AFK_Platform") then
            workspace.AFK_Platform:Destroy()
        end

        local platform = Instance.new("Part")
        platform.Name = "AFK_Platform"
        platform.Size = Vector3.new(25, 25, 25)
        platform.Position = hrp.Position + Vector3.new(0, 2000, 0)
        platform.Anchored = true
        platform.CanCollide = true
        platform.Material = Enum.Material.SmoothPlastic
        platform.Color = Color3.fromRGB(255, 255, 0)
        platform.Parent = workspace

        hrp.CFrame = platform.CFrame + Vector3.new(0, 6, 0)
    end
})

return Mexploits